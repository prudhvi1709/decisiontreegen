<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decision Tree Builder</title>
  <link rel="icon" href="https://raw.githubusercontent.com/gramener/assets/main/straive-favicon.svg" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
  <div class="container py-4">
    <div class="row">
      <div class="col-12">
        <h1 class="text-center mb-4">
          <i class="bi bi-diagram-3 me-2"></i>
          Decision Tree Builder
        </h1>

        <!-- Advanced Settings -->
        <div class="accordion my-3" id="advancedSettings">
          <!-- API Key Setting -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#apiKeyCollapse" aria-expanded="false" aria-controls="apiKeyCollapse">
                <i class="bi bi-key me-2"></i>OpenAI API Key
              </button>
            </h2>
            <div id="apiKeyCollapse" class="accordion-collapse collapse" data-bs-parent="#advancedSettings">
              <div class="accordion-body">
                <div class="mb-3">
                  <label for="apiKeyInput" class="form-label">Enter your OpenAI API Key:</label>
                  <input type="password" class="form-control" id="apiKeyInput" placeholder="sk-..." />
                  <div class="form-text">Your API key is stored locally in your browser and never sent to our servers.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Base URL Setting -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#baseUrlCollapse" aria-expanded="false" aria-controls="baseUrlCollapse">
                <i class="bi bi-link-45deg me-2"></i>Base URL
              </button>
            </h2>
            <div id="baseUrlCollapse" class="accordion-collapse collapse" data-bs-parent="#advancedSettings">
              <div class="accordion-body">
                <div class="mb-3">
                  <label for="baseUrlInput" class="form-label">Enter your OpenAI API Base URL:</label>
                  <input type="text" class="form-control" id="baseUrlInput" value="https://llmfoundry.straive.com/openai/v1" list="baseUrlList" />
                  <datalist id="baseUrlList">
                    <option value="https://api.openai.com/v1"></option>
                    <option value="https://llmfoundry.straive.com/openai/v1"></option>
                    <option value="https://llmfoundry.straivedemo.com/openai/v1"></option>
                    <option value="https://openrouter.ai/api/v1" disabled></option>
                    <option value="https://aipipe.org/openai/v1" disabled></option>
                  </datalist>
                  <div class="form-text">Your API key is stored locally in your browser and never sent to our servers.</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Model Setting -->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#modelCollapse" aria-expanded="false" aria-controls="modelCollapse">
                <i class="bi bi-cpu me-2"></i>Model
              </button>
            </h2>
            <div id="modelCollapse" class="accordion-collapse collapse" data-bs-parent="#advancedSettings">
              <div class="accordion-body">
                <div class="mb-3">
                  <label for="modelInput" class="form-label">Model:</label>
                  <select class="form-select" id="modelInput">
                    <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                    <option value="gpt-4.1-mini">gpt-4.1-mini</option>
                    <option value="gpt-4o-mini">gpt-4o-mini</option>
                    <option value="o3-mini">o3-mini</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sample Datasets -->
        <!-- have 5 cards in a row? -->
        <div class="border rounded p-4 mb-6">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-collection me-2"></i>
            Sample Datasets
          </h3>
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4" id="sampleDatasets">
            <!-- Sample dataset cards will be inserted here -->
          </div>
        </div>

        <!-- Step 1: File Upload -->
        <div class="border rounded p-4 mb-4" id="step1">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-1-circle me-2"></i>
            Step 1: Upload Dataset
          </h3>
          <div class="mb-3">
            <label for="fileInput" class="form-label">Choose CSV or XLSX file:</label>
            <input type="file" class="form-control" id="fileInput" accept=".csv,.xlsx,.xls">
          </div>
          <div id="dataPreview" class="d-none">
            <h5>Data Preview</h5>
            <div style="max-height: 400px; overflow-y: auto;">
              <table class="table table-striped table-hover" id="previewTable">
                <thead class="table-dark"></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Step 2: Prompt Configuration -->
        <div class="border rounded p-4 mb-4 d-none" id="step2">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-2-circle me-2"></i>
            Step 2: Configure Analysis
          </h3>
          <div class="mb-3">
            <label for="targetColumn" class="form-label">Target Column:</label>
            <select class="form-select" id="targetColumn">
              <!-- Options will be populated dynamically -->
            </select>
          </div>
          <div class="mb-3">
            <label for="promptText" class="form-label">Analysis Prompt:</label>
            <textarea class="form-control" id="promptText" rows="4" placeholder="Prompt will be generated automatically..."></textarea>
          </div>
          <button type="button" class="btn btn-primary" id="analyzeBtn">
            <i class="bi bi-play-circle me-2"></i>
            Analyze
          </button>
        </div>

        <!-- Step 3: LLM Response -->
        <div class="border rounded p-4 mb-4 d-none" id="step3">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-3-circle me-2"></i>
            Step 3: AI Analysis
          </h3>
          <div class="accordion" id="llmResponseAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#llmResponseCollapse" aria-expanded="false" aria-controls="llmResponseCollapse">
                  <i class="bi bi-code-slash me-2"></i>
                  View Generated Code
                </button>
              </h2>
              <div id="llmResponseCollapse" class="accordion-collapse collapse">
                <div class="accordion-body">
                  <div id="llmResponse" class="border p-3 bg-light rounded">
                    <!-- LLM response will be streamed here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: Decision Tree Visualization -->
        <div class="border rounded p-4 mb-4 d-none" id="step4">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-4-circle me-2"></i>
            Step 4: Decision Tree
          </h3>
          <div id="decisionTree" class="font-monospace lh-base mb-4">
            <!-- Decision tree will be rendered here -->
          </div>
          <div id="metricsContainer">
            <h5>Model Performance</h5>
            <div class="row g-3 mt-2" id="metricsGrid">
              <!-- Metrics will be displayed here -->
            </div>
          </div>
        </div>

        <!-- Step 5: Revision -->
        <div class="border rounded p-4 mb-4 d-none" id="step5">
          <h3 class="text-primary fw-semibold mb-3">
            <i class="bi bi-5-circle me-2"></i>
            Step 5: Revise Analysis
          </h3>
          <div class="mb-3">
            <label for="revisionPrompt" class="form-label">Revision Instructions:</label>
            <textarea class="form-control" id="revisionPrompt" rows="4" placeholder="Enter any changes you'd like to make to the analysis..."></textarea>
          </div>
          <button type="button" class="btn btn-warning" id="reviseBtn">
            <i class="bi bi-arrow-clockwise me-2"></i>
            Revise Analysis
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center d-none" style="background: rgba(0, 0, 0, 0.5); z-index: 9999;" id="loadingOverlay">
    <div class="text-center text-white">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="mt-2">Processing...</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="script.js"></script>
</body>

</html>
